team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
team_dat_final
e
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
select(team_dat_final, -home_points, -home_days_rest) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- bind_rows(select(team_dat_final, -away_points, -away_days_rest) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points, -home_days_rest) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
#point_margin = home_points - away_points) #%>%
#select(home_team, away_team, year, home_days_rest, away_days_rest, point_margin)
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
team_dat_final <- bind_rows(select(team_dat_final, -away_points, -away_days_rest) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points, -home_days_rest) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final
team_dat_final <- team_dat_final %>% within(home_days_rest <- relevel(home_days_rest, ref = "0"))
team_dat_final <- team_dat_final %>% within(away_days_rest <- relevel(away_days_rest, ref = "0"))
dmy <- dummyVars(~ team_days_rest + opp_days_rest, data = team_dat_final, fullRank = T)
dmy <- data.frame(predict(dmy, newdata = team_dat_final))
team_dat_final <- bind_cols(select(team_dat_final, team, opponent, treatment, year), dmy, select(team_dat_final, points))
team_dat_final <- bind_cols(select(team_dat_final, team, opp, treatment, year), dmy, select(team_dat_final, points))
team_dat_final
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- team_dat_final %>% within(home_days_rest <- relevel(home_days_rest, ref = "3+"))
team_dat_final <- team_dat_final %>% within(away_days_rest <- relevel(away_days_rest, ref = "3+"))
team_dat_final <- team_dat_final %>% within(team_days_rest <- relevel(team_days_rest, ref = "3+"))
team_dat_final <- team_dat_final %>% within(opp_days_rest <- relevel(opp_days_rest, ref = "3+"))
dmy <- dummyVars(~ team_days_rest + opp_days_rest, data = team_dat_final, fullRank = T)
dmy <- data.frame(predict(dmy, newdata = team_dat_final))
team_dat_final <- bind_cols(select(team_dat_final, team, opp, treatment, year), dmy, select(team_dat_final, points))
team_dat_Final
team_dat_final
team_dat_final <- team_dat_final %>% mutate(#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
year = as.factor(year),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2,
rest3 = team_days_rest.3. - opp_days_rest.3.) %>% select(team, opponent, treatment, year, rest3, rest1, rest2, points)
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
year = as.factor(year),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2) %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opponent, treatment, year, rest3, rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
year = as.factor(year),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2) %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opponent, treatment, year, rest3, rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
year = as.factor(year),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2) %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest3, rest1, rest2, points)
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
year = as.factor(year),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2) %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest0, rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
year = as.factor(year),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2) %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest0, rest1, rest2, points)
team_dat_final
with(team_dat_final, table(treatment rest0))
with(team_dat_final, table(treatment, rest0))
lm(points ~ team + year + treatment + rest0 + rest1 + rest2, data = team_dat_final)
lm(points ~ team + year + treatment + rest0 + rest1 + rest2, data = team_dat_final) %>% summary
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- team_dat_final %>% within(team_days_rest <- relevel(team_days_rest, ref = "0"))
team_dat_final <- team_dat_final %>% within(opp_days_rest <- relevel(opp_days_rest, ref = "0"))
dmy <- dummyVars(~ team_days_rest + opp_days_rest, data = team_dat_final, fullRank = T)
dmy <- data.frame(predict(dmy, newdata = team_dat_final))
team_dat_final <- bind_cols(select(team_dat_final, team, opp, treatment, year), dmy, select(team_dat_final, points))
team_dat_final
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
year = as.factor(year),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
#rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2) %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest3, rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
#rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2) %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest3, rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
#rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2,
rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest3, rest1, rest2, points)
lm(points ~ team + year + treatment + rest0 + rest1 + rest2, data = team_dat_final) %>% summary
lm(points ~ team + year + treatment + rest3. + rest1 + rest2, data = team_dat_final) %>% summary
lm(points ~ team + year + treatment + rest3 + rest1 + rest2, data = team_dat_final) %>% summary
with(team_dat_final, table(treatment, rest1))
with(team_dat_final, plot(as.numeric(treatment), rest1))
with(team_dat_final, table(treatment, rest2))
with(team_dat_final, table(treatment, rest3))
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
team_dat_final <- bind_rows(select(team_dat_final, -away_points)%>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- team_dat_final %>% within(team_days_rest <- relevel(team_days_rest, ref = "0"))
team_dat_final <- team_dat_final %>% within(opp_days_rest <- relevel(opp_days_rest, ref = "0"))
dmy <- dummyVars(~ team_days_rest + opp_days_rest, data = team_dat_final, fullRank = T)
dmy <- data.frame(predict(dmy, newdata = team_dat_final))
team_dat_final <- bind_cols(select(team_dat_final, team, opp, treatment, year), dmy, select(team_dat_final, points))
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
#rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2,
rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest3, rest1, rest2, points)
with(team_dat_final, table(treatment, rest2))
lm(points ~ team + year + treatment + rest3 + rest1 + rest2, data = team_dat_final) %>% summary
lm(treatment ~ rest1, data = team_dat_final) %>% summary
lm(treatment ~ rest2, data = team_dat_final) %>% summary
lm(treatment ~ rest3, data = team_dat_final) %>% summary
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
team_dat_final <- bind_rows(select(team_dat_final, -away_points, -away_days_rest) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opponent = away_team, points = home_points, days_rest = home_days_rest),
select(team_dat_final, -home_points, -home_days_rest) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opponent = home_team, points = away_points, days_rest = away_days_rest))
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- team_dat_final %>% within(team_days_rest <- relevel(team_days_rest, ref = "0"))
team_dat_final <- team_dat_final %>% within(opp_days_rest <- relevel(opp_days_rest, ref = "0"))
dmy <- dummyVars(~ team_days_rest + opp_days_rest, data = team_dat_final, fullRank = T)
dmy <- data.frame(predict(dmy, newdata = team_dat_final))
team_dat_final <- bind_cols(select(team_dat_final, team, opp, treatment, year), dmy, select(team_dat_final, points))
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
#rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2,
rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest3, rest1, rest2, points)
lm(treatment ~ rest3, data = team_dat_final) %>% summary
lm(treatment ~ rest1, data = team_dat_final) %>% summary
lm(points ~ team + year + treatment + rest3 + rest1 + rest2, data = team_dat_final) %>% summary
lm(points ~ treatment, data = team_dat_final)
lm(points ~ treatment, data = team_dat_final) %>% summary
lm(points ~ team + year + treatment + rest3 + rest1 + rest2, data = team_dat_final) %>% summary
sqrt(0.1038/(1-0.1038))
sqrt(.022/(1-.022))
with(team_dat_final ,cor(rest1, rest3))
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- team_dat_final %>% within(team_days_rest <- relevel(team_days_rest, ref = "3+"))
team_dat_final <- team_dat_final %>% within(opp_days_rest <- relevel(opp_days_rest, ref = "3+"))
dmy <- dummyVars(~ team_days_rest + opp_days_rest, data = team_dat_final, fullRank = T)
dmy <- data.frame(predict(dmy, newdata = team_dat_final))
team_dat_final <- bind_cols(select(team_dat_final, team, opp, treatment, year), dmy, select(team_dat_final, points))
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
#rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2,
rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest3, rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2)  %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest3, rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2)  %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest0, rest1, rest2, points)
lm(points ~ team + year + treatment + rest0+ rest1 + rest2, data = team_dat_final) %>% summary
lm(treatment ~ team + year + rest0+ rest1 + rest2, data = team_dat_final) %>% summary
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
team_dat_final <- bind_rows(select(team_dat_final, -away_points, -away_days_rest) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opponent = away_team, points = home_points, days_rest = home_days_rest),
select(team_dat_final, -home_points, -home_days_rest) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opponent = home_team, points = away_points, days_rest = away_days_rest))
team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- bind_rows(select(team_dat_final, -away_points, -away_days_rest) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opponent = away_team, points = home_points, days_rest = home_days_rest),
select(team_dat_final, -home_points, -home_days_rest) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opponent = home_team, points = away_points, days_rest = away_days_rest))
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
team_dat_final <- bind_rows(select(team_dat_final, -away_points, -away_days_rest) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opponent = away_team, points = home_points, days_rest = home_days_rest),
select(team_dat_final, -home_points, -home_days_rest) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opponent = home_team, points = away_points, days_rest = away_days_rest))
team_dat_final <- team_dat_final %>% within(team_days_rest <- relevel(team_days_rest, ref = "0"))
team_dat_final <- team_dat_final %>% within(opp_days_rest <- relevel(opp_days_rest, ref = "0"))
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- team_dat_final %>% within(team_days_rest <- relevel(team_days_rest, ref = "0"))
team_dat_final <- team_dat_final %>% within(opp_days_rest <- relevel(opp_days_rest, ref = "0"))
dmy <- dummyVars(~ team_days_rest + opp_days_rest, data = team_dat_final, fullRank = T)
dmy <- data.frame(predict(dmy, newdata = team_dat_final))
team_dat_final <- bind_cols(select(team_dat_final, team, opp, treatment, year), dmy, select(team_dat_final, points))
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2)  %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest0, rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest3. = team_days_rest.3. - opp_days_rest.3.,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2)  %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest0, rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest3. = team_days_rest.3. - opp_days_rest.3.,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2)  %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest03., rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest3. = team_days_rest.3. - opp_days_rest.3.,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2)  %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest3., rest1, rest2, points)
lm(treatment ~ team + year + rest3 + rest1 + rest2, data = team_dat_final) %>% summary
lm(treatment ~ team + year + rest3. + rest1 + rest2, data = team_dat_final) %>% summary
lm(treatment ~ team + year + treatment + rest3. + rest1 + rest2, data = team_dat_final) %>% summary
lm(points ~ treatment+ team + year + rest3 + rest1 + rest2, data = team_dat_final) %>% summary
lm(points ~ treatment+ team + year + rest3. + rest1 + rest2, data = team_dat_final) %>% summary
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
team_dat_final <- bind_rows(select(team_dat_final, -away_points, -away_days_rest) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opponent = away_team, points = home_points, days_rest = home_days_rest),
select(team_dat_final, -home_points, -home_days_rest) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opponent = home_team, points = away_points, days_rest = away_days_rest))
team_dat_final <- team_dat_final %>% within(team_days_rest <- relevel(team_days_rest, ref = "3+"))
team_dat_final <- team_dat_final %>% within(opp_days_rest <- relevel(opp_days_rest, ref = "3+"))
team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- team_dat_final %>% within(team_days_rest <- relevel(team_days_rest, ref = "3+"))
team_dat_final <- team_dat_final %>% within(opp_days_rest <- relevel(opp_days_rest, ref = "3+"))
dmy <- dummyVars(~ team_days_rest + opp_days_rest, data = team_dat_final, fullRank = T)
dmy <- data.frame(predict(dmy, newdata = team_dat_final))
team_dat_final <- bind_cols(select(team_dat_final, team, opp, treatment, year), dmy, select(team_dat_final, points))
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest3. = team_days_rest.3. - opp_days_rest.3.,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2)  %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest3., rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2)  %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest0, rest1, rest2, points)
lm(points ~ treatment+ team + year + rest0 + rest1 + rest2, data = team_dat_final) %>% summary
#################################################################################################################################################
# Drop where at least one team is playing first game
# Drop playoff games
team_dat_final <- team_dat %>% filter(complete.cases(.)) %>%
mutate(home_days_rest = ifelse(home_days_rest - 1 > 2, "3+", home_days_rest - 1) %>% as.factor(),
away_days_rest = ifelse(away_days_rest - 1 > 2, "3+", away_days_rest - 1) %>% as.factor())
set.seed(123)
home_teams <- sample(seq_len(nrow(team_dat_final)), size = nrow(team_dat_final)/2)
team_dat_final <- bind_rows(select(team_dat_final, -away_points) %>% slice(home_teams) %>% mutate(treatment = 1) %>% rename(team = home_team, opp = away_team, team_days_rest = home_days_rest, opp_days_rest = away_days_rest, points = home_points),
select(team_dat_final, -home_points) %>% slice(-home_teams) %>% mutate(treatment = 0) %>% rename(team = away_team, opp = home_team, team_days_rest = away_days_rest, opp_days_rest = home_days_rest, points = away_points))
team_dat_final <- team_dat_final %>% within(team_days_rest <- relevel(team_days_rest, ref = "0"))
team_dat_final <- team_dat_final %>% within(opp_days_rest <- relevel(opp_days_rest, ref = "0"))
dmy <- dummyVars(~ team_days_rest + opp_days_rest, data = team_dat_final, fullRank = T)
dmy <- data.frame(predict(dmy, newdata = team_dat_final))
team_dat_final <- bind_cols(select(team_dat_final, team, opp, treatment, year), dmy, select(team_dat_final, points))
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest0 = team_days_rest.0 - opp_days_rest.0,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2)  %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest0, rest1, rest2, points)
team_dat_final <- team_dat_final %>% mutate(year = as.factor(year),
#team = ifelse(treatment == 1, as.character(home_team), as.character(away_team)),
#opp = ifelse(treatment == -1, as.character(away_team), as.character(home_team)),
#point_margin = ifelse(treatment == 1, point_margin, point_margin*-1),
rest3. = team_days_rest.3. - opp_days_rest.3.,
rest1 = team_days_rest.1 - opp_days_rest.1,
rest2 = team_days_rest.2 - opp_days_rest.2)  %>%
#rest3 = team_days_rest.3. - opp_days_rest.3.) %>%
select(team, opp, treatment, year, rest3., rest1, rest2, points)
lm(points ~ treatment+ team + year + rest3. + rest1 + rest2, data = team_dat_final) %>% summary
11.79^2 * 6021
lm(points ~ treatment+ team + year, data = team_dat_final) %>% summary
11.8^2 * 6024
11.79^2 * 6021
red = 11.8^2 * 6024
full = 11.79^2 * 6021
(red - full)/red
lm(points ~team + year + rest3. + rest1 + rest2, data = team_dat_final) %>% summary
lm(points ~treatment + team + year + rest3. + rest1 + rest2, data = team_dat_final) %>% summary
red = 11.86^2 * 6022
full = 11.79^2 * 6021
(red - full)/red
lm(points ~treatment + team + year + rest3. + rest1 + rest2, data = team_dat_final) %>% summary
red = 11.8^2 * 6024
full = 11.79^2 * 6021
(red-full)/red
full = lm(points ~treatment + team + year + rest3. + rest1 + rest2, data = team_dat_final) %>% summary
deviance(full)
full = lm(points ~treatment + team + year + rest3. + rest1 + rest2, data = team_dat_final)
deviance(full)
full
red = lm(points ~treatment + team + year, data = team_dat_final)
deviance(red)
(deviance(red) - deviance(full))/deviance(red)
red = 11.8^2 * 6024
full
red
Soil.C<-c(13,20,10,11,2,25,30,25,23)
Soil.N<-c(1.2,2,1.5,1,0.3,2,3,2.7,2.5)
Slope<-c(15,14,16,12,10,18,25,24,20)
Aspect<-c(45,120,100,56,5,20,5,15,15)
Y<-as.vector(c(20,30,10,15,5,45,60,55,45))
lm.with<-lm(Y~Soil.C+Soil.N+Slope+Aspect)
lm.without<-update(lm.with, ~. - Soil.N)
partial.R2(lm.without,lm.with)
install.packages("asbio")
library(asbio)
Soil.C<-c(13,20,10,11,2,25,30,25,23)
Soil.N<-c(1.2,2,1.5,1,0.3,2,3,2.7,2.5)
Slope<-c(15,14,16,12,10,18,25,24,20)
Aspect<-c(45,120,100,56,5,20,5,15,15)
Y<-as.vector(c(20,30,10,15,5,45,60,55,45))
lm.with<-lm(Y~Soil.C+Soil.N+Slope+Aspect)
lm.without<-update(lm.with, ~. - Soil.N)
partial.R2(lm.without,lm.with)
library(tcltk)
install.packages("XQuartz")
full
red
red = lm(points ~treatment + team + year, data = team_dat_final)
red
install.packages(rsq)
install.packages('rsq')
library(rsq)
rsq.partial(full, red)
df = data.frame(which = c("Control", "Control", "Treatment", "Treatment"), color = c("red", "blue", "red", "blue"), response = c(2,3,1,4), count = c(10,20,14,21))
df
melt(df)
library(reshape2)
melt(df)
melt(df) %>% cast( color ~ which + variable)
melt(df) %>% dcast( color ~ which + variable)
head(team_dat_final)
lm(points ~ team:year + opp:year + treatment + rest3. + rest1 + rest2, data = team_dat_final)
lm(points ~ team:year + opp:year + treatment + rest3. + rest1 + rest2, data = team_dat_final) %>% summary
m1 = lm(points ~ team:year + opp:year + treatment + rest3. + rest1 + rest2, data = team_dat_final)
plot(m1)
lm(points ~ team:year + opp:year + treatment, data = team_dat_final) %>% summary
lm(points ~ treatment, data = team_dat_final) %>% summary
write_csv(team_dat_final, "../data/output_data/matchup_final.csv")
write_csv(team_dat_final, "/data/output_data/matchup_final.csv")
write_csv(team_dat_final, "data/output_data/matchup_final.csv")
